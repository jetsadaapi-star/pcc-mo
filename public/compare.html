<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCC-MO | ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</title>
    <meta name="description" content="‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .compare-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-lg);
        }

        .compare-card {
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            text-align: center;
        }

        .compare-card.period-a {
            border-top: 3px solid var(--color-primary);
        }

        .compare-card.period-b {
            border-top: 3px solid var(--color-secondary);
        }

        .compare-card.diff {
            border-top: 3px solid var(--color-info);
        }

        .compare-label {
            font-size: 0.85rem;
            color: var(--color-text-muted);
            margin-bottom: var(--space-xs);
        }

        .compare-title {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-lg);
        }

        .compare-stat {
            margin-bottom: var(--space-md);
        }

        .compare-stat-label {
            font-size: 0.85rem;
            color: var(--color-text-muted);
        }

        .compare-stat-value {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-text);
        }

        .compare-sub {
            font-size: 0.9rem;
            color: var(--color-text-soft);
            margin-top: var(--space-xs);
        }

        .diff-positive {
            color: var(--color-success) !important;
        }

        .diff-negative {
            color: var(--color-error) !important;
        }

        @media (max-width: 900px) {
            .compare-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Background Pattern -->
    <div class="bg-pattern">
        <div class="floating-shape floating-shape-1"></div>
        <div class="floating-shape floating-shape-2"></div>
        <div class="floating-shape floating-shape-3"></div>
    </div>

    <div class="app-layout">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="menu-toggle" aria-label="‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π">‚ò∞</button>
        <div class="mobile-overlay" id="mobile-overlay"></div>
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-logo">PCC</div>
                <div class="brand-text">
                    <h1>PCC-MO</h1>
                    <p>Concrete Monitor</p>
                </div>
            </div>

            <nav class="nav-menu">
                <a href="/" class="nav-item">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
                <a href="/orders" class="nav-item">
                    <span class="nav-icon">üìã</span>
                    <span>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</span>
                </a>
                <a href="/analytics" class="nav-item">
                    <span class="nav-icon">üìà</span>
                    <span>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</span>
                </a>
                <a href="/compare" class="nav-item active">
                    <span class="nav-icon">‚öñÔ∏è</span>
                    <span>‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</span>
                </a>
                <a href="/settings" class="nav-item">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
                </a>
            </nav>

            <div class="nav-footer">
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span>Live Dashboard</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="page-header">
                <div>
                    <h1 class="page-title">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h1>
                    <p class="page-subtitle">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</p>
                </div>
                <div class="page-actions">
                    <button class="btn btn-primary" onclick="compare.loadComparison()">
                        ‚öñÔ∏è ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
                    </button>
                </div>
            </header>

            <!-- Period Selectors -->
            <section class="grid-2 mb-lg">
                <!-- Period A -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" style="color: var(--color-primary);">üìÖ ‡∏ä‡πà‡∏ß‡∏á A</h3>
                    </div>
                    <div class="form-group mb-md">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        <input type="date" id="a-start" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        <input type="date" id="a-end" class="form-input">
                    </div>
                    <div class="quick-dates mt-md">
                        <button class="quick-date-btn" onclick="compare.setPreset('a', 'month')">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
                        <button class="quick-date-btn" onclick="compare.setPreset('a', 'lastMonth')">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô</button>
                        <button class="quick-date-btn" onclick="compare.setPreset('a', 'quarter')">‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡∏ô‡∏µ‡πâ</button>
                    </div>
                </div>

                <!-- Period B -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" style="color: var(--color-secondary);">üìÖ ‡∏ä‡πà‡∏ß‡∏á B</h3>
                    </div>
                    <div class="form-group mb-md">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        <input type="date" id="b-start" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        <input type="date" id="b-end" class="form-input">
                    </div>
                    <div class="quick-dates mt-md">
                        <button class="quick-date-btn" onclick="compare.setPreset('b', 'month')">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
                        <button class="quick-date-btn" onclick="compare.setPreset('b', 'lastMonth')">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô</button>
                        <button class="quick-date-btn" onclick="compare.setPreset('b', 'quarter')">‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡∏ô‡∏µ‡πâ</button>
                    </div>
                </div>
            </section>

            <!-- Comparison Results -->
            <section class="compare-grid" id="compare-results">
                <!-- Period A Results -->
                <div class="compare-card period-a">
                    <p class="compare-title">üìä ‡∏ä‡πà‡∏ß‡∏á A</p>
                    <div class="compare-stat">
                        <p class="compare-stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                        <p class="compare-stat-value" id="a-orders">-</p>
                    </div>
                    <div class="compare-sub">
                        ‡∏õ‡∏π‡∏ô‡∏£‡∏ß‡∏°: <strong id="a-cement">-</strong> ‡∏Ñ‡∏¥‡∏ß
                    </div>
                    <div class="compare-sub">
                        ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: <strong id="a-avg">-</strong> ‡∏Ñ‡∏¥‡∏ß
                    </div>
                </div>

                <!-- Period B Results -->
                <div class="compare-card period-b">
                    <p class="compare-title">üìä ‡∏ä‡πà‡∏ß‡∏á B</p>
                    <div class="compare-stat">
                        <p class="compare-stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                        <p class="compare-stat-value" id="b-orders">-</p>
                    </div>
                    <div class="compare-sub">
                        ‡∏õ‡∏π‡∏ô‡∏£‡∏ß‡∏°: <strong id="b-cement">-</strong> ‡∏Ñ‡∏¥‡∏ß
                    </div>
                    <div class="compare-sub">
                        ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: <strong id="b-avg">-</strong> ‡∏Ñ‡∏¥‡∏ß
                    </div>
                </div>

                <!-- Difference -->
                <div class="compare-card diff">
                    <p class="compare-title">üìà ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á (A - B)</p>
                    <div class="compare-stat">
                        <p class="compare-stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                        <p class="compare-stat-value" id="diff-orders">-</p>
                    </div>
                    <div class="compare-sub">
                        ‡∏õ‡∏π‡∏ô‡∏£‡∏ß‡∏°: <strong id="diff-cement">-</strong> ‡∏Ñ‡∏¥‡∏ß
                    </div>
                    <div class="compare-sub">
                        ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: <strong id="diff-avg">-</strong> ‡∏Ñ‡∏¥‡∏ß
                    </div>
                </div>
            </section>

            <!-- Summary Message -->
            <section class="card mt-lg">
                <div class="card-header">
                    <h3 class="card-title">üí° ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h3>
                </div>
                <p class="text-soft" id="compare-summary">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏î "‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                </p>
            </section>
        </main>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script src="/js/main.js"></script>
    <script>
        const compare = {
            init() {
                this.setDefaultPeriods();
            },

            setDefaultPeriods() {
                const today = new Date();
                const currentMonthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                const lastMonthStart = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                const lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);

                // Period A: Current month
                PCCMO.setInputValue('a-start', PCCMO.toISODate(currentMonthStart));
                PCCMO.setInputValue('a-end', PCCMO.toISODate(today));

                // Period B: Last month
                PCCMO.setInputValue('b-start', PCCMO.toISODate(lastMonthStart));
                PCCMO.setInputValue('b-end', PCCMO.toISODate(lastMonthEnd));
            },

            setPreset(period, preset) {
                const today = new Date();
                let start, end;

                switch (preset) {
                    case 'month':
                        start = new Date(today.getFullYear(), today.getMonth(), 1);
                        end = today;
                        break;
                    case 'lastMonth':
                        start = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                        end = new Date(today.getFullYear(), today.getMonth(), 0);
                        break;
                    case 'quarter':
                        const quarter = Math.floor(today.getMonth() / 3);
                        start = new Date(today.getFullYear(), quarter * 3, 1);
                        end = today;
                        break;
                }

                PCCMO.setInputValue(`${period}-start`, PCCMO.toISODate(start));
                PCCMO.setInputValue(`${period}-end`, PCCMO.toISODate(end));
            },

            async loadComparison() {
                const aStart = PCCMO.getInputValue('a-start');
                const aEnd = PCCMO.getInputValue('a-end');
                const bStart = PCCMO.getInputValue('b-start');
                const bEnd = PCCMO.getInputValue('b-end');

                if (!aStart || !aEnd || !bStart || !bEnd) {
                    PCCMO.showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'error');
                    return;
                }

                try {
                    const [dataA, dataB] = await Promise.all([
                        PCCMO.fetchAnalytics({ startDate: aStart, endDate: aEnd }),
                        PCCMO.fetchAnalytics({ startDate: bStart, endDate: bEnd })
                    ]);

                    this.renderComparison(dataA, dataB);
                } catch (error) {
                    console.error('Comparison error:', error);
                    PCCMO.showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                }
            },

            renderComparison(dataA, dataB) {
                const totalsA = dataA.totals || {};
                const totalsB = dataB.totals || {};

                // Period A
                PCCMO.setText('a-orders', PCCMO.formatNumber(totalsA.order_count || 0));
                PCCMO.setText('a-cement', PCCMO.formatDecimal(totalsA.total_cement || 0));
                PCCMO.setText('a-avg', PCCMO.formatDecimal(totalsA.avg_cement || 0));

                // Period B
                PCCMO.setText('b-orders', PCCMO.formatNumber(totalsB.order_count || 0));
                PCCMO.setText('b-cement', PCCMO.formatDecimal(totalsB.total_cement || 0));
                PCCMO.setText('b-avg', PCCMO.formatDecimal(totalsB.avg_cement || 0));

                // Differences
                const diffOrders = (totalsA.order_count || 0) - (totalsB.order_count || 0);
                const diffCement = (totalsA.total_cement || 0) - (totalsB.total_cement || 0);
                const diffAvg = (totalsA.avg_cement || 0) - (totalsB.avg_cement || 0);

                this.setDiffValue('diff-orders', diffOrders, false);
                this.setDiffValue('diff-cement', diffCement, true);
                this.setDiffValue('diff-avg', diffAvg, true);

                // Summary
                const summary = this.generateSummary(totalsA, totalsB, diffOrders, diffCement);
                PCCMO.setText('compare-summary', summary);

                PCCMO.showToast('‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            },

            setDiffValue(id, value, isDecimal) {
                const el = document.getElementById(id);
                if (!el) return;

                const formatted = isDecimal ? PCCMO.formatDecimal(value) : PCCMO.formatNumber(value);
                const prefix = value >= 0 ? '+' : '';
                el.textContent = prefix + formatted;
                el.classList.toggle('diff-positive', value > 0);
                el.classList.toggle('diff-negative', value < 0);
            },

            generateSummary(totalsA, totalsB, diffOrders, diffCement) {
                const ordersA = totalsA.order_count || 0;
                const ordersB = totalsB.order_count || 0;

                if (ordersA === 0 && ordersB === 0) {
                    return '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á';
                }

                let summary = '';

                if (diffOrders > 0) {
                    summary += `‡∏ä‡πà‡∏ß‡∏á A ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á B ${PCCMO.formatNumber(diffOrders)} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                } else if (diffOrders < 0) {
                    summary += `‡∏ä‡πà‡∏ß‡∏á B ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á A ${PCCMO.formatNumber(Math.abs(diffOrders))} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                } else {
                    summary += '‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô';
                }

                summary += ' ‚Ä¢ ';

                if (diffCement > 0) {
                    summary += `‡∏ä‡πà‡∏ß‡∏á A ‡πÉ‡∏ä‡πâ‡∏õ‡∏π‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ${PCCMO.formatDecimal(diffCement)} ‡∏Ñ‡∏¥‡∏ß`;
                } else if (diffCement < 0) {
                    summary += `‡∏ä‡πà‡∏ß‡∏á B ‡πÉ‡∏ä‡πâ‡∏õ‡∏π‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ${PCCMO.formatDecimal(Math.abs(diffCement))} ‡∏Ñ‡∏¥‡∏ß`;
                } else {
                    summary += '‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÉ‡∏ä‡πâ‡∏õ‡∏π‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô';
                }

                return summary;
            }
        };

        document.addEventListener('DOMContentLoaded', () => compare.init());
    </script>
</body>

</html>